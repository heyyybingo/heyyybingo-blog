---
title: 浏览器的渲染过程
date: 2022-09-19 00:00:00
categories:
  - 浏览器
tags:
  - html
  - css
  - js
  - 浏览器
---

# 渲染过程

![渲染流程](images/browerFlow.png)

- 解析 HTML，生成 DOM 树，解析 CSS，生成 CSSOM 树

- 将 DOM 树和 CSSOM 树结合，生成渲染树(Render Tree)

- Layout(回流):根据生成的渲染树，进行回流(Layout)，得到节点的几何信息（位置，大小）

- Painting(重绘):根据渲染树以及回流得到的几何信息，得到节点的绝对像素

- Display: 将像素发送给 GPU，最后通过调用操作系统 Native GUI 的 API 绘制，展示在页面上。

# js 会阻塞页面加载

浏览器有 GUI 渲染线程与 JS 引擎线程，为了防止渲染出现不可预期的结果，这两个线程是互斥的关系。JavaScript 的加载、解析与执行会阻塞 DOM 的构建

# css 会阻塞 dom 渲染

- DOM 和 CSSOM 通常是并行构建的, <strong>CSS 加载不会阻塞 DOM 的解析</strong>。
- 由于 Render Tree 是依赖于 DOM Tree 和 CSSOM Tree 的，<strong>CSS 加载会阻塞 Dom 的渲染</strong>
- js 是可操纵 DOM 和 css 样式 的 <strong>css 会阻塞后面 js 的执行</strong>

# DOMContentLoaded 与 load

- 当 DOMContentLoaded 事件触发时,仅当 DOM 解析完成后,不包括样式表,图片。我们前面提到 CSS 加载会阻塞 Dom 的渲染和后面 js 的执行,js 会阻塞 Dom 解析,所以我们可以得到结论:当文档中没有脚本时,浏览器解析完文档便能触发 DOMContentLoaded 事件。如果文档中包含脚本,则脚本会阻塞文档的解析,而脚本需要等 CSSOM 构建完成才能执行。在任何情况下,DOMContentLoaded 的触发不需要等待图片等其他资源加载完成。
- 当 onload 事件触发时,页面上所有的 DOM,样式表,脚本,图片等资源已经加载完毕。
- DOMContentLoaded -> load。
